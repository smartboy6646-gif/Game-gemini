<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>3D Penalty Tournament (Fixed Sudden Death)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;overflow:hidden;background:#000;font-family:Arial}
#hud{
position:fixed;top:8px;width:100%;text-align:center;
color:#fff;font-size:14px;line-height:1.4
}
</style>
</head>
<body>

<div id="hud">Loading Tournament...</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
/* ================= BASIC ================= */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87ceeb);

const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,1000);
camera.position.set(0,6,12);
camera.lookAt(0,2,0);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.6));
const sun=new THREE.DirectionalLight(0xffffff,0.7);
sun.position.set(5,10,5);
scene.add(sun);

/* ================= GROUND ================= */
const ground=new THREE.Mesh(
 new THREE.PlaneGeometry(40,20),
 new THREE.MeshStandardMaterial({color:0x1f7a3a})
);
ground.rotation.x=-Math.PI/2;
scene.add(ground);

/* ================= GOAL ================= */
const goalMat=new THREE.MeshStandardMaterial({color:0xffffff});
function goal(w,h,d,x,y,z){
 const g=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),goalMat);
 g.position.set(x,y,z);scene.add(g);
}
goal(6,0.2,0.2,0,3,-8);
goal(0.2,3,0.2,-3,1.5,-8);
goal(0.2,3,0.2,3,1.5,-8);

/* ================= BALL ================= */
const ball=new THREE.Mesh(
 new THREE.SphereGeometry(0.3,32,32),
 new THREE.MeshStandardMaterial({color:0xffffff})
);
scene.add(ball);

/* ================= GOALKEEPER ================= */
const keeper=new THREE.Mesh(
 new THREE.BoxGeometry(1.2,2,0.6),
 new THREE.MeshStandardMaterial({color:0xffd700})
);
keeper.position.set(0,1,-7.5);
scene.add(keeper);

/* ================= STICKMAN ================= */
const man=new THREE.Group();
const head=new THREE.Mesh(
 new THREE.SphereGeometry(0.25,16,16),
 new THREE.MeshStandardMaterial({color:0xffffff})
);
head.position.y=1.7;
const body=new THREE.Mesh(
 new THREE.CylinderGeometry(0.15,0.2,1),
 new THREE.MeshStandardMaterial({color:0xffffff})
);
body.position.y=1;
const leg1=new THREE.Mesh(
 new THREE.CylinderGeometry(0.08,0.1,0.9),
 new THREE.MeshStandardMaterial({color:0xffffff})
);
leg1.position.set(-0.15,0.45,0);
const leg2=leg1.clone();
leg2.position.x=0.15;

man.add(head,body,leg1,leg2);
man.position.set(0,0,4);
scene.add(man);

/* ================= TOURNAMENT ================= */
const TEAMS=[
"Brazil","Argentina","France","Germany","Spain","Portugal","England","Italy",
"Netherlands","Belgium","Croatia","Uruguay","Mexico","USA","Japan","Korea",
"Senegal","Morocco","Nigeria","Ghana","Cameroon","Egypt","Iran","Saudi",
"Australia","Denmark","Poland","Serbia","Switzerland","Sweden","Chile","Colombia"
];
const ROUND={32:"Round of 32",16:"Round of 16",8:"Quarter Final",4:"Semi Final",2:"Final"};
function shuffle(a){for(let i=a.length-1;i>0;i--){let j=Math.random()*(i+1)|0;[a[i],a[j]]=[a[j],a[i]];}return a;}

let roundTeams=shuffle([...TEAMS]),nextRound=[];
let matchIndex=0,matchNo=1;

/* ================= MATCH ================= */
let scoreA=0,scoreB=0;
let kick=0;
let sudden=false;
let suddenTurn=0; // 0=A, 1=B
let shooting=false;

let targetX=0,curve=0,speed=0,keeperDir=0;

function hud(t){document.getElementById("hud").innerHTML=t;}

function resetPos(){
 ball.position.set(0,0.3,4);
 keeper.position.x=0;
 shooting=false;
}

function startShot(){
 shooting=true;
 targetX=(Math.random()*4)-2;
 curve=(Math.random()-0.5)*0.03;
 speed=0.22+Math.random()*0.05;
 keeperDir=Math.sign(targetX)*(0.06+Math.random()*0.04);
}

function resolveShot(){
 const save=Math.abs(ball.position.x-keeper.position.x)<0.9;
 if(!save){
   if(!sudden){
     kick%2===0?scoreA++:scoreB++;
   }else{
     suddenTurn===0?scoreA++:scoreB++;
   }
 }

 if(!sudden) kick++;

 resetPos();

 // Normal penalties
 if(!sudden && kick>=10){
   if(scoreA!==scoreB) return endMatch();
   sudden=true; suddenTurn=0;
 }

 // Sudden death (A then B)
 if(sudden){
   if(suddenTurn===1){
     if(scoreA!==scoreB) return endMatch();
     suddenTurn=0;
   }else suddenTurn=1;
 }

 setTimeout(startShot,700);
}

function endMatch(){
 const A=roundTeams[matchIndex],B=roundTeams[matchIndex+1];
 const winner=scoreA>scoreB?A:B;
 nextRound.push(winner);

 hud(`üèÅ ${A} ${scoreA} - ${scoreB} ${B}<br><b>Winner: ${winner}</b>`);

 setTimeout(()=>{
   matchIndex+=2;matchNo++;
   scoreA=scoreB=kick=0;sudden=false;
   if(matchIndex>=roundTeams.length){
     roundTeams=[...nextRound];
     nextRound=[];
     matchIndex=0;
   }
   if(roundTeams.length===1){
     hud(`üèÜ TOURNAMENT CHAMPION<br><b>${roundTeams[0]}</b>`);
     return;
   }
   resetPos();
   setTimeout(startShot,1000);
 },2000);
}

/* ================= LOOP ================= */
function animate(){
 requestAnimationFrame(animate);

 if(!shooting){
   const A=roundTeams[matchIndex],B=roundTeams[matchIndex+1];
   hud(`<b>${ROUND[roundTeams.length]}</b> | Match ${matchNo}<br>
${A} ${scoreA} - ${scoreB} ${B}${sudden?"<br><i>Sudden Death</i>":""}`);
 }

 if(shooting){
   ball.position.z-=speed;
   ball.position.x+=targetX*0.02+curve;
   keeper.position.x+=keeperDir;
   leg1.rotation.x=-0.6; leg2.rotation.x=0.3;

   if(ball.position.z<-7.3){
     leg1.rotation.x=0; leg2.rotation.x=0;
     resolveShot();
   }
 }

 renderer.render(scene,camera);
}

resetPos();
setTimeout(startShot,1000);
animate();

window.addEventListener("resize",()=>{
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
