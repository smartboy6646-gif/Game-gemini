<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Gully Cricket Pro</title>
    <style>
        :root { --primary: #1565c0; --four: #ffeb3b; --six: #ff9800; --wicket: #d32f2f; --extra: #4caf50; --bg: #f4f7f6; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; justify-content: center; overflow: hidden; touch-action: manipulation; -webkit-user-select: none; user-select: none; }
        .card { background: white; width: 100%; max-width: 450px; height: 92vh; border-radius: 25px; display: flex; flex-direction: column; padding: 15px; box-sizing: border-box; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        .batsman-section { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; background: #e3f2fd; padding: 12px; border-radius: 15px; }
        .batsman-card { padding: 8px; border-radius: 10px; font-size: 0.9rem; font-weight: bold; transition: 0.3s; }
        .active-striker { background: #bbdefb; border-left: 5px solid var(--primary); transform: scale(1.02); }
        .bat-name { display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .bat-score { color: var(--primary); font-size: 1.1rem; }

        .score-box { background: var(--primary); color: white; border-radius: 20px; padding: 15px; text-align: center; flex-shrink: 0; }
        .score-box h1 { font-size: 3.5rem; margin: 0; letter-spacing: -2px; }
        
        .history-container { flex-grow: 1; overflow-y: auto; margin: 10px 0; padding: 5px; background: #fdfdfd; border-radius: 12px; border: 1px solid #eee; }
        .over-row { background: white; margin-bottom: 8px; padding: 8px; border-radius: 10px; display: flex; align-items: center; gap: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); flex-wrap: wrap; }
        .over-label { font-weight: bold; min-width: 55px; font-size: 0.8rem; color: #888; border-right: 1px solid #f0f0f0; }

        .ball { min-width: 30px; height: 30px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; color: #333; }
        .b-4 { background: var(--four); color: #000; } .b-6 { background: var(--six); color: #fff; } .b-w { background: var(--wicket); color: #fff; } .b-ex { background: var(--extra); color: #fff; }

        .controls { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; flex-shrink: 0; padding-bottom: 5px; }
        button { padding: 14px 2px; border: none; border-radius: 12px; font-weight: bold; font-size: 1.1rem; cursor: pointer; -webkit-tap-highlight-color: transparent; }
        .btn-gray { background: #e0e0e0; } .btn-4 { background: var(--four); } .btn-6 { background: var(--six); color: white; } .btn-wd { background: #f57c00; color: white; } .btn-wicket { background: var(--wicket); color: white; grid-column: span 2; } .btn-undo { background: #78909c; color: white; grid-column: span 2; } .btn-action { background: #2e7d32; color: white; grid-column: span 4; padding: 12px; margin-top: 5px; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; padding: 25px; border-radius: 25px; width: 85%; max-width: 320px; text-align: center; }
    </style>
</head>
<body>

<div id="nb-modal" class="modal"><div class="modal-content">
    <h3>No Ball Extras</h3>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
        <button onclick="addNoBall(0)">NB+0</button><button onclick="addNoBall(1)">NB+1</button>
        <button onclick="addNoBall(2)">NB+2</button><button onclick="addNoBall(4)" class="b-4">NB+4</button>
        <button onclick="addNoBall(6)" class="b-6" style="background:var(--six);color:white">NB+6</button>
    </div>
    <button style="background:#333;color:white;width:100%;margin-top:10px" onclick="closeModal('nb-modal')">Cancel</button>
</div></div>

<div class="card">
    <div class="batsman-section">
        <div id="b1-card" class="batsman-card active-striker" onclick="manualSwap()">
            <span class="bat-name" id="b1-name">Batsman 1 *</span>
            <span class="bat-score" id="b1-score">0(0)</span>
        </div>
        <div id="b2-card" class="batsman-card" onclick="manualSwap()">
            <span class="bat-name" id="b2-name">Batsman 2</span>
            <span class="bat-score" id="b2-score">0(0)</span>
        </div>
    </div>

    <div class="score-box">
        <h1 id="main-score">0 - 0</h1>
        <div style="font-size: 1.1rem; font-weight: bold;">Overs: <span id="overs-txt">0.0</span></div>
        <div id="target-ui" style="display:none; font-size:0.9rem; margin-top:8px; background:rgba(255,255,255,0.2); border-radius:8px; padding:5px">
            Target: <span id="target-val">0</span> | Need: <span id="need-val">0</span>
        </div>
    </div>

    <div id="over-history" class="history-container"></div>

    <div class="controls">
        <button class="btn-gray" onclick="addRun(0)">0</button>
        <button class="btn-gray" onclick="addRun(1)">1</button>
        <button class="btn-gray" onclick="addRun(2)">2</button>
        <button class="btn-gray" onclick="addRun(3)">3</button>
        <button class="btn-4" onclick="addRun(4)">4</button>
        <button class="btn-6" onclick="addRun(6)">6</button>
        <button class="btn-wd" onclick="addWide()">WD</button>
        <button class="btn-wd" style="background:#f57c00" onclick="openModal('nb-modal')">NB</button>
        <button class="btn-wicket" onclick="takeWicket()">WICKET</button>
        <button class="btn-undo" onclick="undo()">UNDO</button>
        <button class="btn-action" id="action-btn" onclick="switchInnings()">FINISH INNINGS</button>
    </div>
</div>

<script>
    let score = 0, wickets = 0, balls = 0, target = 0, innings = 1, history = [];
    let b1 = { name: "B1", runs: 0, balls: 0 }, b2 = { name: "B2", runs: 0, balls: 0 };
    let striker = b1, nonStriker = b2;

    window.onload = () => {
        b1.name = prompt("Striker Name:", "Batsman 1") || "B1";
        b2.name = prompt("Non-Striker Name:", "Batsman 2") || "B2";
        updateDisplay();
    };

    function updateDisplay() {
        document.getElementById('main-score').innerText = `${score} - ${wickets}`;
        document.getElementById('overs-txt').innerText = `${Math.floor(balls/6)}.${balls%6}`;
        document.getElementById('b1-name').innerText = b1.name + (striker === b1 ? " *" : "");
        document.getElementById('b1-score').innerText = `${b1.runs}(${b1.balls})`;
        document.getElementById('b2-name').innerText = b2.name + (striker === b2 ? " *" : "");
        document.getElementById('b2-score').innerText = `${b2.runs}(${b2.balls})`;
        document.getElementById('b1-card').className = `batsman-card ${striker === b1 ? 'active-striker' : ''}`;
        document.getElementById('b2-card').className = `batsman-card ${striker === b2 ? 'active-striker' : ''}`;
        if (innings === 2) {
            document.getElementById('target-ui').style.display = "block";
            document.getElementById('need-val').innerText = (target - score) > 0 ? (target - score) : "0";
        }
    }

    function addRun(r) {
        save(); score += r; striker.runs += r; striker.balls++; balls++;
        if (r % 2 !== 0) swap(); 
        if (balls % 6 === 0 && balls > 0) swap();
        updateLog(r); updateDisplay();
    }

    function addWide() { save(); score += 1; updateLog('WD'); updateDisplay(); }
    function addNoBall(r) {
        save(); score += (r + 1); striker.runs += r;
        if (r % 2 !== 0) swap(); updateLog(`NB${r>0?'+'+r:''}`); updateDisplay(); closeModal('nb-modal');
    }

    function takeWicket() {
        save(); wickets++; striker.balls++; balls++; updateLog('W');
        if (wickets < 10) {
            let n = prompt("Naya Batsman:"); striker.name = n || "B" + (wickets + 2);
            striker.runs = 0; striker.balls = 0;
        }
        if (balls % 6 === 0) swap(); updateDisplay();
    }

    function swap() { [striker, nonStriker] = [nonStriker, striker]; }
    function manualSwap() { save(); swap(); updateDisplay(); }

    function updateLog(val) {
        let isL = !isNaN(val) || val === 'W';
        let oN = isL ? Math.floor((balls - 1) / 6) : Math.floor(balls / 6);
        let c = document.getElementById('over-history');
        let oB = document.getElementById(`over-${oN}`);
        if (!oB) {
            oB = document.createElement('div'); oB.className = 'over-row'; oB.id = `over-${oN}`;
            oB.innerHTML = `<div class="over-label">Over ${oN + 1}</div>`; c.prepend(oB);
        }
        let b = document.createElement('div');
        b.className = `ball ${val==4?'b-4':val==6?'b-6':val==='W'?'b-w':isNaN(val)?'b-ex':''}`;
        b.innerText = val; oB.appendChild(b);
    }

    function switchInnings() {
        if(confirm("Next Innings?")) {
            target = score + 1; innings = 2; score = 0; wickets = 0; balls = 0;
            b1.runs = 0; b1.balls = 0; b2.runs = 0; b2.balls = 0;
            b1.name = prompt("Striker Name:") || "B1"; b2.name = prompt("Non-Striker Name:") || "B2";
            document.getElementById('over-history').innerHTML = ""; updateDisplay();
        }
    }

    function save() { history.push({s:score, w:wickets, b:balls, b1r:b1.runs, b1b:b1.balls, b2r:b2.runs, b2b:b2.balls, st:striker===b1?'b1':'b2', h:document.getElementById('over-history').innerHTML}); }
    function undo() {
        if (history.length > 0) {
            let l = history.pop(); score = l.s; wickets = l.w; balls = l.b;
            b1.runs = l.b1r; b1.balls = l.b1b; b2.runs = l.b2r; b2.balls = l.b2b;
            striker = (l.st === 'b1' ? b1 : b2); nonStriker = (l.st === 'b1' ? b2 : b1);
            document.getElementById('over-history').innerHTML = l.h; updateDisplay();
        }
    }
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
</script>
</body>
</html>
